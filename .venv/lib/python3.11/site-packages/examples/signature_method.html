
<!DOCTYPE html>


<html lang="en" data-content_root="../../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>The Signature Method with Sktime &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '.venv/lib/python3.11/site-packages/examples/signature_method';</script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../../../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">My sample book</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../../../intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2F.venv/lib/python3.11/site-packages/examples/signature_method.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../../../_sources/.venv/lib/python3.11/site-packages/examples/signature_method.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>The Signature Method with Sktime</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-path-signature">The Path Signature</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-visualisation">A Visualisation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#depth-1">Depth 1:</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#depth-2">Depth 2:</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Depth &gt; 2:</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-signature-in-time-series-analysis">The Signature in Time-Series Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#considered-signature-variations">Considered Signature Variations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-sktime-modules">The Sktime Modules</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-1-sequential-data-signature-features">Example 1: Sequential Data -&gt; Signature Features.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-2-fine-tuning-the-generalised-model">Example 2: Fine Tuning the Generalised Model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-full-description-of-the-parameters">A Full Description of the Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="the-signature-method-with-sktime">
<h1>The Signature Method with Sktime<a class="headerlink" href="#the-signature-method-with-sktime" title="Link to this heading">#</a></h1>
<p>The ‘signature method’ refers to a collection of feature extraction techniques for multimodal sequential data, derived from the theory of controlled differential equations. In recent years, a large number of modifications have been suggested to the signature method so as to improve some aspect of it.</p>
<p>In the paper <a class="reference external" href="https://arxiv.org/abs/2006.00873">“A Generalised Signature Method for Time-Series”</a> [1] the authors collated the vast majority of these modifications into a single document and ran a large hyper-parameter study over the multivariate UEA datasets to build a generic signature algorithm that is expected to work well on a wide range of datasets. We implement the best practice results from this study as the default starting values for our hyperparameters in the <code class="docutils literal notranslate"><span class="pre">SignatureClassifier</span></code> module.</p>
<section id="the-path-signature">
<h2>The Path Signature<a class="headerlink" href="#the-path-signature" title="Link to this heading">#</a></h2>
<p>At the heart of the signature method is the so-called “signature transform”.</p>
<p>A path <span class="math notranslate nohighlight">\(X\)</span> of finite length in <span class="math notranslate nohighlight">\(\textit{d}\)</span> dimensions can be described by the mapping <span class="math notranslate nohighlight">\(X:[a, b]\rightarrow\mathbb{R}\)</span> <span class="math notranslate nohighlight">\(\!\!^d\)</span>, or in terms of coordinates <span class="math notranslate nohighlight">\(X=(X^1_t, X^2_t, ...,X^d_t)\)</span>, where each coordinate <span class="math notranslate nohighlight">\(X^i_t\)</span> is real-valued and parameterised by <span class="math notranslate nohighlight">\(t\in[a,b]\)</span>.</p>
<p>The <strong>signature transform</strong> <span class="math notranslate nohighlight">\(S\)</span> of a path <span class="math notranslate nohighlight">\(X\)</span> is defined as an infinite sequence of values:
\begin{equation}
S(X)<em>{a, b} = (1, S(X)</em>{a, b}^1, S(X)<em>{a, b}^2, …, S(X)</em>{a, b}^d, S(X)<em>{a,b}^{1, 1}, S(X)</em>{a,b}^{1, 2}, …),
\label{eq:path_signature}
\end{equation}
where each term is a <span class="math notranslate nohighlight">\(k\)</span>-fold iterated integral of <span class="math notranslate nohighlight">\(X\)</span> with multi-index <span class="math notranslate nohighlight">\(i_1,...,i_k\)</span>:
\begin{equation}
S(X)<em>{a, b}^{i_1,…,i_k} = \int</em>{a&lt;t_k&lt;b}…\int_{a&lt;t_1&lt;t_2} \mathrm{d}X_{t_1}^{i_1}…\mathrm{d}X_{t_k}^{i_k}.
\label{eq:sig_moments}
\end{equation}
This defines a graded sequence of numbers associated with a path which is known to characterise it up to a generalised form of reparameterisation [2]. One can think of the signature as a collection of summary statistics that determine a path (almost) uniquely. Furthermore, any continuous function on the path <span class="math notranslate nohighlight">\(X\)</span> can be approximated arbitrarily well as a linear function on its signature [3]; the signature unravels the non-linearities on functions on the space of unparameterised paths.</p>
<section id="a-visualisation">
<h3>A Visualisation<a class="headerlink" href="#a-visualisation" title="Link to this heading">#</a></h3>
<p>To give an idea of what the signature terms represent physically, we consider a patient in an ICU where we are tracking their systolic blood pressure (SBP) and heart rate (HR) changing in time. This can be represented as a path in <span class="math notranslate nohighlight">\(\mathbb{R}^3\)</span> (assuming time is included as a channel).</p>
<p><img alt="signature_visualisation" src=".venv/lib/python3.11/site-packages/examples/img/signatures_term_visualisation.png" /></p>
<p>The plot above sketches two scenarios of how such a path might look. We are assuming here an implicit time dimension for each plot such that the path is traversed from left to right along the blue line.</p>
<section id="depth-1">
<h4>Depth 1:<a class="headerlink" href="#depth-1" title="Link to this heading">#</a></h4>
<p>The signature terms to depth 1 are simply the changes of each of the variables over the interval, in the image this is the <span class="math notranslate nohighlight">\(\Delta \text{HR}\)</span> and <span class="math notranslate nohighlight">\(\Delta \text{SBP}\)</span> terms. Note that these values are the same in each case.</p>
</section>
<section id="depth-2">
<h4>Depth 2:<a class="headerlink" href="#depth-2" title="Link to this heading">#</a></h4>
<p>The second level gives us the signed areas (the shaded orange regions), where the orientation of the left most plot is such that the negatively signed area is produced whereas the second gives the positive value, and thus, at order 2 in the signature we now have sufficient information to discriminate between these two situations where in the first rise in heart rate occurs before (or at least, initially faster than) the rise in blood pressure, and vice versa.</p>
</section>
<section id="id1">
<h4>Depth &gt; 2:<a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<p>Depths larger than 2 become more difficult to visualise graphically, however the idea is similar to that of the depth 2 case where we saw that the signature produced information on whether the increase in HR or SBP appeared to be happening first, along with some numerical quantification of how much this was happening. At higher orders the signature is doing something similar, but now with three events, rather than two. The signature picks out structural information regarding the order in which events occur.</p>
</section>
</section>
<section id="the-signature-in-time-series-analysis">
<h3>The Signature in Time-Series Analysis<a class="headerlink" href="#the-signature-in-time-series-analysis" title="Link to this heading">#</a></h3>
<p>The signature is a natural tool to apply in problems related to time-series analysis. As described above it can convert multi-dimensional time-series data into static features that represent information about the sequential nature of the time-series, that can be fed through a standard machine learning model.</p>
<p>A simplistic view of how this works is as follows:
\begin{equation}
\text{Model}(\text{Signature}(\text{Sequential data}))) = \text{Predictions}
\end{equation}</p>
</section>
</section>
<section id="considered-signature-variations">
<h2>Considered Signature Variations<a class="headerlink" href="#considered-signature-variations" title="Link to this heading">#</a></h2>
<p>Again, following the work in [1] we group the variations on the signature method conceptually into:</p>
<ul class="simple">
<li><p><strong>Augmentations</strong> - Transformation of an input sequence or time series into one or more new sequences, so that the signature will return different information about the path.</p></li>
<li><p><strong>Windows</strong> - Windowing operations, so that the signature can act with some locality.</p></li>
<li><p><strong>Transforms</strong> - The choice between the signature or the logsignature transformation.</p></li>
<li><p><strong>Rescalings</strong> - Method of signature rescaling.</p></li>
</ul>
<p>This is neatly represented in the following graphic, where <span class="math notranslate nohighlight">\(\phi\)</span> represents the augmentation, <span class="math notranslate nohighlight">\(W^{i, j}\)</span> the windowing operation, <span class="math notranslate nohighlight">\(S^N\)</span> the signature, and <span class="math notranslate nohighlight">\(\rho_{\text{pre}/\text{post}}\)</span> the rescalig method.</p>
<img class="center" src="img/signatures_generalised_method.png" width="500"/>
<p>Please refer to the full paper for a more comprehensive exploration into what each of these groupings means.</p>
</section>
<section id="the-sktime-modules">
<h2>The Sktime Modules<a class="headerlink" href="#the-sktime-modules" title="Link to this heading">#</a></h2>
<p>We now give an introduction to the classification and transformation modules included in th sktime interface, along with an example to show how to perform efficient hyperparameter optimisation that was found to give good results in [1].</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Some additional imports we will use</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">accuracy_score</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sktime.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_gunpoint</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load an example dataset</span>
<span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span> <span class="o">=</span> <span class="n">load_gunpoint</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">load_gunpoint</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>D:\CMP Machine Learning\sktime-workshop-boss\sktime\utils\data_io.py:63: FutureWarning: This function has moved to datasets/_data_io, this version will be removed in V0.10
  warn(
</pre></div>
</div>
</div>
</div>
<section id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h3>
<p>We provide the following:</p>
<ul class="simple">
<li><p><strong>sktime.transformers.panel.signature_based.SignatureTransformer</strong> - An sklearn transformer that provides the functionality to apply the signature method with some choice of variations as noted above.</p></li>
<li><p><strong>sktime.classification.feature_based.SignatureClassifier</strong> - This provides a simple interface to append a classifier to the SignatureTransformer class.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sktime.classification.feature_based</span><span class="w"> </span><span class="kn">import</span> <span class="n">SignatureClassifier</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sktime.transformations.panel.signature_based</span><span class="w"> </span><span class="kn">import</span> <span class="n">SignatureTransformer</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="example-1-sequential-data-signature-features">
<h3>Example 1: Sequential Data -&gt; Signature Features.<a class="headerlink" href="#example-1-sequential-data-signature-features" title="Link to this heading">#</a></h3>
<p>Here we will give a very simple example of converting the sequential 3D GunPoint data of shape [num_batch, series_length, num_features] -&gt; [num_batch, signature_features].</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First build a very simple signature transform module</span>
<span class="n">signature_transform</span> <span class="o">=</span> <span class="n">SignatureTransformer</span><span class="p">(</span>
    <span class="n">augmentation_list</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;addtime&quot;</span><span class="p">,),</span>
    <span class="n">window_name</span><span class="o">=</span><span class="s2">&quot;global&quot;</span><span class="p">,</span>
    <span class="n">window_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">window_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">window_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rescaling</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">sig_tfm</span><span class="o">=</span><span class="s2">&quot;signature&quot;</span><span class="p">,</span>
    <span class="n">depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># The simply transform the stream data</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Raw data shape is: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">train_x</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="n">train_signature_x</span> <span class="o">=</span> <span class="n">signature_transform</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Signature shape is: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">train_signature_x</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Raw data shape is: (50, 1)
Signature shape is: (50, 14)
</pre></div>
</div>
</div>
</div>
<p>It then becomes extremely easy to build a time-series classification model. For example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Train</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_signature_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>

<span class="c1"># Evaluate</span>
<span class="n">test_signature_x</span> <span class="o">=</span> <span class="n">signature_transform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
<span class="n">test_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_signature_x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy: </span><span class="si">{:.3f}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">test_y</span><span class="p">,</span> <span class="n">test_pred</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy: 0.740%
</pre></div>
</div>
</div>
</div>
</section>
<section id="example-2-fine-tuning-the-generalised-model">
<h3>Example 2: Fine Tuning the Generalised Model<a class="headerlink" href="#example-2-fine-tuning-the-generalised-model" title="Link to this heading">#</a></h3>
<p>As previously mentioned, in [1] the authors performed a large hyperparameter search over the signature variations on the full UEA archive to develop a ‘Best Practices’ approach to building a model. This required some fine tuning over the following parameters, as they were found to be very dataset specific:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">depth</span></code> over [1, 2, 3, 4, 5, 6]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">window_depth</span></code> over [2, 3, 4]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RandomForestClassifier</span></code> hyperparamters.</p></li>
</ul>
<p>Here we show how this is easily done using the sktime framework.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomizedSearchCV</span><span class="p">,</span> <span class="n">StratifiedKFold</span>

<span class="c1"># Some params</span>
<span class="n">n_cv_splits</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">n_gs_iter</span> <span class="o">=</span> <span class="mi">20</span>

<span class="c1"># Random forests found to perform very well in general</span>
<span class="n">estimator</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>

<span class="c1"># The grid to be passed to an sklearn gridsearch</span>
<span class="n">signature_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Signature params</span>
    <span class="s2">&quot;depth&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="s2">&quot;window_name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;dyadic&quot;</span><span class="p">],</span>
    <span class="s2">&quot;augmentation_list&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="s2">&quot;basepoint&quot;</span><span class="p">,</span> <span class="s2">&quot;addtime&quot;</span><span class="p">]],</span>
    <span class="s2">&quot;window_depth&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
    <span class="s2">&quot;rescaling&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;post&quot;</span><span class="p">],</span>
    <span class="c1"># Classifier and classifier params</span>
    <span class="s2">&quot;estimator&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">estimator</span><span class="p">],</span>
    <span class="s2">&quot;estimator__n_estimators&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span>
    <span class="s2">&quot;estimator__max_depth&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span>
<span class="p">}</span>

<span class="c1"># Initialise the estimator</span>
<span class="n">estimator</span> <span class="o">=</span> <span class="n">SignatureClassifier</span><span class="p">()</span>

<span class="c1"># Run a random grid search and return the gs object</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">n_cv_splits</span><span class="p">)</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">signature_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">n_cv_splits</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="n">n_gs_iter</span><span class="p">)</span>
<span class="n">gs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>

<span class="c1"># Get the best classifier</span>
<span class="n">best_classifier</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">best_estimator_</span>

<span class="c1"># Evaluate</span>
<span class="n">train_preds</span> <span class="o">=</span> <span class="n">best_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
<span class="n">test_preds</span> <span class="o">=</span> <span class="n">best_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
<span class="n">train_score</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">train_y</span><span class="p">,</span> <span class="n">train_preds</span><span class="p">)</span>
<span class="n">test_score</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">test_y</span><span class="p">,</span> <span class="n">test_preds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Train acc: </span><span class="si">{:.3f}</span><span class="s2">%  |  Test acc: </span><span class="si">{:.3f}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">train_score</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">test_score</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train acc: 100.000%  |  Test acc: 96.000%
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="a-full-description-of-the-parameters">
<h2>A Full Description of the Parameters<a class="headerlink" href="#a-full-description-of-the-parameters" title="Link to this heading">#</a></h2>
<p>We conclude by giving further explanation of each of the parameters in the <code class="docutils literal notranslate"><span class="pre">SignatureClassifier</span></code> module and what values they can take.</p>
</section>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Link to this heading">#</a></h2>
<p>Below we list each parameter and the values that they can take. For further details about what the options mean refer to [1].</p>
<p><strong>classifier</strong> Needs to be any sklearn estimator. Defaults to <code class="docutils literal notranslate"><span class="pre">RandomForestClassifier()</span></code>.</p>
<p><strong>augmentation_list</strong>: list of tuple of strings, List of augmentations to be applied before the signature transform is applied. These can be any from:</p>
<ul class="simple">
<li><p>‘addtime’ - Add an equally spaced time channel.</p></li>
<li><p>‘leadlag’ - The leadlag transform.</p></li>
<li><p>‘ir’ - Perform the invisibility reset transform.</p></li>
<li><p>‘cumsum’ - Perform a cumulative sum transform.</p></li>
<li><p>‘basepoint’ - Append zero to the start of the path to remove translational invariance.</p></li>
</ul>
<p><strong>window_name</strong> str, The name of the window transform to apply. Can be any of:</p>
<ul class="simple">
<li><p>‘global’ - A single window over all the data.</p></li>
<li><p>‘expanding’ - Multiple windows starting at the first datapoint that extend over the data (increasing width).</p></li>
<li><p>‘sliding’ - Multiple windows that slide along the data (fixed width).</p></li>
<li><p>‘dyadic’ - Partition the data into dyadic windows.</p></li>
</ul>
<p><strong>window_depth</strong>: int, The depth of the dyadic window. (Active only if <code class="docutils literal notranslate"><span class="pre">window_name</span> <span class="pre">==</span> <span class="pre">'dyadic']</span></code>).</p>
<p><strong>window_length</strong>: int, The length of the sliding/expanding window. (Active only if <code class="docutils literal notranslate"><span class="pre">window_name</span> <span class="pre">in</span> <span class="pre">['sliding,</span> <span class="pre">'expanding'].</span></code>)</p>
<p><strong>window_step</strong>: int, The step of the sliding/expanding window. (Active only if <code class="docutils literal notranslate"><span class="pre">window_name</span> <span class="pre">in</span> <span class="pre">['sliding,</span> <span class="pre">'expanding'].</span></code>)</p>
<p><strong>rescaling</strong>: str, The method of signature rescaling. Any of:</p>
<ul class="simple">
<li><p>‘pre’ - Rescale the path before the signature transform.</p></li>
<li><p>‘post’ - Rescale the path after the signature transform.</p></li>
<li><p>None - No rescaling.</p></li>
</ul>
<p><strong>sig_tfm</strong>: str, String to specify the type of signature transform. Either of: [‘signature’, ‘logsignature’].</p>
<p><strong>depth</strong>: int, Signature truncation depth.</p>
<p><strong>random_state</strong>: int, Random state initialisation.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
<p>[1] Morrill, James, Adeline Fermanian, Patrick Kidger, and Terry Lyons. “A Generalised Signature Method for Time Series.” arXiv preprint arXiv:2006.00873 (2020).</p>
<p>[2] Hambly, B., Lyons, T.: Uniqueness for the signature of a path of bounded variation and the reduced pathgroup. Annals of Mathematics171(1), 109–167 (2010). doi:10.4007/annals.2010.171.10913.</p>
<p>[3] Lyons, T.J.: Differential equations driven by rough signals. Revista Matem ́atica Iberoamericana14(2), 215–310(1998)</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./.venv/lib/python3.11/site-packages/examples"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-path-signature">The Path Signature</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-visualisation">A Visualisation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#depth-1">Depth 1:</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#depth-2">Depth 2:</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Depth &gt; 2:</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-signature-in-time-series-analysis">The Signature in Time-Series Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#considered-signature-variations">Considered Signature Variations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-sktime-modules">The Sktime Modules</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-1-sequential-data-signature-features">Example 1: Sequential Data -&gt; Signature Features.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-2-fine-tuning-the-generalised-model">Example 2: Fine Tuning the Generalised Model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-full-description-of-the-parameters">A Full Description of the Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>